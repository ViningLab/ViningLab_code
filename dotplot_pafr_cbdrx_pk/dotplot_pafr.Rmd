---
title: "Dotplot"
output: html_document
date: "2023-05-09"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.align = "center")
```


https://cran.r-project.org/web/packages/pafr/index.html


```{r}
library(pafr)
#my_paf <- read_paf("CBDRx_Purple_Kush.paf")
my_paf <- read_paf("CBDRx_Purple_Kush.paf.gz")
my_paf
```


```{r}
prim_alignment <- filter_secondary_alignments(my_paf)
nrow(my_paf)
nrow(prim_alignment)
dotplot(prim_alignment, 
        #order_by = "provided", 
        label_seqs = TRUE, 
        xlab = "Purple Kush", 
        ylab = "CBDRx")
```


## Subset


```{r}
as.data.frame(prim_alignment)[1:3, 1:12]
# table(prim_alignment$tname)
ali <- prim_alignment[grep("NC_044", prim_alignment$tname), ]
nrow(ali)
hist(ali$qlen)

ali <- ali[ali$qlen > 2e07, ]
nrow(ali)
```


```{r}
p <- dotplot(ali, 
             #order_by = "provided", 
             label_seqs = TRUE, 
             xlab = "Purple Kush", 
             ylab = "CBDRx")
p <- p + theme_bw()
p
```


## CHROM3


```{r}
table(ali$tname)

chrom3 <- ali[ali$tname == "NC_044372.1", ]

p <- dotplot(chrom3, 
             #order_by = "provided", 
             label_seqs = TRUE, 
             xlab = "Purple Kush", 
             ylab = "CBDRx")
p <- p + theme_bw()
p

sort(table(ali$qname), decreasing = TRUE)
#chrom3a <- chrom3[chrom3$qname == "CM010790.2", ]
#chrom3a <- chrom3[chrom3$qname == "CM010794.2", ]
#chrom3a <- chrom3[grep("CM010793.2|CM010794.2|CM010795.2", chrom3$qname), ]
#chrom3a <- chrom3[grep("CM010790.2|CM010792.2|CM010793.2|CM010794.2", chrom3$qname), ]
#chrom3a <- chrom3[grep("CM010790.2|CM010791.2|CM010792.2|CM010793.2|CM010794.2", chrom3$qname), ]
chrom3a <- chrom3[grep("CM010790.2|CM010794.2|CM010792.2", chrom3$qname), ]

#chrom3a <- chrom3[chrom3$qname == "CM010791.2", ]

p <- dotplot(chrom3a, 
             #order_by = "provided", 
             label_seqs = TRUE, 
             xlab = "Purple Kush", 
             ylab = "CBDRx")
p <- p + theme_bw()
p <- p + theme( axis.text.x = element_text(angle = 60, hjust = 1) )
p

# ggsave(filename = "CBDRx_chrom3_PK_dotplot.tiff", 
#        device = "tiff", 
#        width = 3.25, height = 3.25, units = "in", dpi = 300)

```



